<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Running a Client - Mitosis Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="Mitosis is a Rust library and a command line tool to run distributed platforms for transport research.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="../guide/installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="../guide/coordinator.html"><strong aria-hidden="true">2.</strong> Running a Coordinator</a></li><li class="chapter-item expanded "><a href="../guide/worker.html"><strong aria-hidden="true">3.</strong> Running a Worker</a></li><li class="chapter-item expanded "><a href="../guide/client.html" class="active"><strong aria-hidden="true">4.</strong> Running a Client</a></li><li class="chapter-item expanded affix "><li class="part-title">Reference Guide</li><li class="chapter-item expanded "><a href="../client/sdk.html"><strong aria-hidden="true">5.</strong> Client SDK</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Mitosis Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/stack-rs/mitosis/tree/master/guide" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/stack-rs/mitosis/edit/master/guide/src/guide/client.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="running-a-client"><a class="header" href="#running-a-client">Running a Client</a></h1>
<p>A Client is a process that interact with the Coordinator.
It is responsible for creating tasks, querying their results, and managing workers or groups.
The Client is a short-lived process that is typically run on-demand.</p>
<h2 id="starting-a-client"><a class="header" href="#starting-a-client">Starting a Client</a></h2>
<p>While it's possible to provide a TOML configuration file to the client,
it's often unnecessary given the limited number of configuration items, all of which pertain to login procedures.</p>
<p>Typically, to start a Client, we can simply run the following command to enter interactive mode:</p>
<pre><code class="language-bash">mito client -i
</code></pre>
<p>If a user has never logged in or if his/her session has expired, the Client will prompt them to re-input their username and password for authentication.
Alternatively, they can directly specify their username (<code>-u</code>) or password (<code>-p</code>) during execution.
Once authenticated, the Client will retain their credentials in a file for future use.</p>
<p>We recommend using the interactive mode for most operations, as it provides a more user-friendly experience. It will prompt you something like this:</p>
<pre><code class="language-txt">[mito::client]&gt;
</code></pre>
<p>You can press <code>CTRL-D</code> or type in <code>exit</code> to exit the interactive mode. <code>CTRL-C</code> will just clear the current line and prompt you again.</p>
<p>We can also directly run a command without entering interactive mode by specifying the command as an argument.
For example, to create a new user, we can run:</p>
<pre><code class="language-bash">mito client create user -u new_user -p new_password
</code></pre>
<p>The full list of command-line arguments can be found by running <code>mito client --help</code>:</p>
<pre><code class="language-txt">Run a mitosis client

Usage: mito client [OPTIONS] [COMMAND]

Commands:
  auth      Authenticate the user
  create    Create a new user or group
  get       Get the info of a task, artifact, attachment, or a list of tasks subject to the filters
  submit    Submit a task
  upload    Upload an artifact or attachment
  manage    Manage a worker, a task or a group
  shutdown  Shutdown the coordinator
  quit      Quit the client's interactive mode
  help      Print this message or the help of the given subcommand(s)

Options:
      --config &lt;CONFIG&gt;                    The path of the config file
  -c, --coordinator &lt;COORDINATOR_ADDR&gt;     The address of the coordinator
      --credential-path &lt;CREDENTIAL_PATH&gt;  The path of the user credential file
  -u, --user &lt;USER&gt;                        The username of the user
  -p, --password &lt;PASSWORD&gt;                The password of the user
  -i, --interactive                        Enable interactive mode
  -h, --help                               Print help
  -V, --version                            Print version
</code></pre>
<p>To know how each subcommand works, you can run <code>mito client &lt;subcommand&gt; --help</code>.
For example, to know how to create a new user, you can run <code>mito client create user --help</code>:</p>
<pre><code class="language-txt">Create a new user

Usage: mito client create user [OPTIONS] --username &lt;USERNAME&gt; --password &lt;PASSWORD&gt;

Options:
  -u, --username &lt;USERNAME&gt;  The username of the user
  -p, --password &lt;PASSWORD&gt;  The password of the user
      --admin                Whether the user is an admin
  -h, --help                 Print help
  -V, --version              Print version
</code></pre>
<p>For the rest of this section, we will explain the common use cases of the Client on different scenarios.
For the sake of convenience, we will assume that the user is already in interactive mode.
And for the direct executing mode, it only requires adding "mito client" at the front.</p>
<h2 id="create-sub-commands"><a class="header" href="#create-sub-commands"><code>Create</code> sub-commands</a></h2>
<p>Input <code>help create</code> to show the help message of the <code>create</code> sub-commands:</p>
<pre><code class="language-txt">Create a new user or group

Usage: create &lt;COMMAND&gt;

Commands:
  user   Create a new user
  group  Create a new group
  help   Print this message or the help of the given subcommand(s)

Options:
  -h, --help  Print help
</code></pre>
<p>We can create a new user by running the following command:</p>
<pre><code class="language-txt">create user -u test_user_name -p test_user_password
</code></pre>
<p>We can create a new group by running the following command:</p>
<pre><code class="language-txt">create group test_group
</code></pre>
<p>This will create a group called <code>test_group</code> containing the current logged in user.
This user will be granted the <code>Admin</code> role to this group to manage it.</p>
<h2 id="submit-sub-commands"><a class="header" href="#submit-sub-commands"><code>Submit</code> sub-commands</a></h2>
<p>Input <code>help submit</code> to show the help message of the <code>submit</code> sub-commands:</p>
<pre><code class="language-txt">Submit a task

Usage: submit [OPTIONS] [-- &lt;COMMAND&gt;...]

Arguments:
  [COMMAND]...  The command to run

Options:
  -g, --group &lt;GROUP_NAME&gt;    The name of the group this task is submitted to
  -t, --tags [&lt;TAGS&gt;...]      The tags of the task, used to filter workers to execute the task
  -l, --labels [&lt;LABELS&gt;...]  The labels of the task, used for querying tasks
      --timeout &lt;TIMEOUT&gt;     The timeout of the task [default: 10min]
  -p, --priority &lt;PRIORITY&gt;   The priority of the task [default: 0]
  -e, --envs [&lt;ENVS&gt;...]      The environment variables to set
      --terminal              Whether to collect the terminal standard output and error of the executed task
      --watch &lt;WATCH&gt;         The UUID and the state of the task to watch before triggering this task. Should specify it as `UUID,STATE`, e.g. `123e4567-e89b-12d3-a456-426614174000,ExecSpawned`
  -h, --help                  Print help
</code></pre>
<p>Submit a task to the Coordinator can be as simple as running the following command:</p>
<pre><code class="language-txt">submit -- echo hello
</code></pre>
<p>The content after <code>--</code> is the command to run on the worker. It will return a UUID to identify the task.</p>
<p>You can also specify the group to submit the task to by using the <code>-g</code> option.</p>
<p>The <code>labels</code> are used to mark the task for querying later, it won't affect how the task is fetched ans executed.</p>
<p>The <code>tags</code> are used to define the characteristics of the task, such as its requirements on the Worker.
Only when a Worker's tags are empty or are the subset of the task's tags, the Worker can fetch the task.</p>
<p>You can also set some environment variables for the task by using the <code>-e</code> option.</p>
<pre><code class="language-txt">submit -g test_group -t wireless,4g -l mobile,video -e TEST_KEY=1,TEST_VAL=2 -- echo hello
</code></pre>
<p>For the output of the task, we allow 3 types of output to be collected:</p>
<ol>
<li><strong>Result</strong>: Files put under the directory specified by the environment variable <code>MITO_RESULT_DIR</code> will be packed into an artifact and uploaded to the Coordinator.
If the directory is empty, no artifact will be created.</li>
<li><strong>Exec</strong>: Files put under the directory specified by the environment variable <code>MITO_EXEC_DIR</code> will be packed into an artifact and uploaded to the Coordinator.
If the directory is empty, no artifact will be created.</li>
<li><strong>Terminal</strong>: If the <code>--terminal</code> option is specified, the standard output and error of the executed task will be collected and uploaded to the Coordinator.
The terminal output will be stored in a file named <code>stdout.log</code> and <code>stderr.log</code> respectively in an artifact.</li>
</ol>
<h2 id="get-sub-commands"><a class="header" href="#get-sub-commands"><code>Get</code> sub-commands</a></h2>
<p>Input <code>help get</code> to show the help message of the <code>get</code> sub-commands:</p>
<pre><code class="language-txt">Get the info of task, attachment, worker or group, or query a list of them subject to the filters. Download attachment and artifact is also supported

Usage: get &lt;COMMAND&gt;

Commands:
  task             Get the info of a task
  tasks            Query a list of tasks subject to the filter
  attachment-meta  Get the metadata of an attachment
  attachments      Query a list of attachments subject to the filter
  worker           Get the info of a worker
  workers          Query a list of workers subject to the filter
  group            Get the information of a group
  groups           Get all groups the user has access to
  artifact         Download an artifact of a task
  attachment       Download an attachment of a group
  help             Print this message or the help of the given subcommand(s)

Options:
  -h, --help  Print help (see more with '--help')
</code></pre>
<p>Basically, the <code>get</code> sub-commands are used to query information or download files from the Coordinator.
For information, it can be a task, a worker, a group, or a list of them subject to the filters.</p>
<p>For example, you get a task's information by providing its UUID:</p>
<pre><code class="language-txt">get task e07a2bf2-166d-40b5-8bb6-a78104c072f9
</code></pre>
<p>Or you can just query a list of tasks with label <code>mobile</code>:</p>
<pre><code class="language-txt">get tasks -l mobile
</code></pre>
<p>More filter options can be found in the help message by executing <code>get tasks -h</code></p>
<p>You can also get the information of a group with its name and that of a worker with its id.
Query a list of them is also supported with similar logic as querying tasks.</p>
<p>For downloading files, you can download an artifact of a task or an attachment of a group.
To make it clear, an artifact is a collection of files generated by a task (as output), while an attachment is a file uploaded to a group.</p>
<p>It is easy to download an artifact of a task by providing its UUID. But you also have to specify the the output type you want.
There are three types of output: <code>result</code>, <code>exec-log</code>, and <code>std-log</code>. You can also specify the output path to download the artifact to with <code>-o</code> argument.</p>
<pre><code class="language-txt">get artifact e07a2bf2-166d-40b5-8bb6-a78104c072f9 result
</code></pre>
<p>To download an attachment of a group, you can provide the group name and the attachment key:</p>
<pre><code class="language-txt">get attachment test_group attachment_key
</code></pre>
<h2 id="upload-sub-commands"><a class="header" href="#upload-sub-commands"><code>Upload</code> sub-commands</a></h2>
<p>Input <code>help upload</code> to show the help message of the <code>upload</code> sub-commands:</p>
<pre><code class="language-txt">Upload an artifact or attachment

Usage: upload &lt;COMMAND&gt;

Commands:
  artifact    Upload an artifact to a task
  attachment  Upload an attachment to a group
  help        Print this message or the help of the given subcommand(s)

Options:
  -h, --help  Print help
</code></pre>
<p>Similar to how we download files with <code>get</code> sub-commands, we can upload an artifact to a task or an attachment to a group.</p>
<p>For example, to upload an artifact to a task as result, we can run:</p>
<pre><code class="language-txt">upload artifact e07a2bf2-166d-40b5-8bb6-a78104c072f9 result local.tar.gz
</code></pre>
<p>Another example, to upload an attachment to a group, we can run:</p>
<pre><code class="language-txt">upload attachment -g test_group local.tar.gz attachment_key
</code></pre>
<p>You can also just run <code>upload attachment local.tar.gz</code>.
This will directly upload the file to the current group you are in and use the file name as the attachment key.</p>
<h2 id="manage-sub-commands"><a class="header" href="#manage-sub-commands"><code>Manage</code> sub-commands</a></h2>
<p>Input <code>help manage</code> to show the help message of the <code>manage</code> sub-commands:</p>
<pre><code class="language-txt">Manage a worker, a task or a group

Usage: manage &lt;COMMAND&gt;

Commands:
  worker  Manage a worker
  task    Manage a task
  group   Manage a group
  help    Print this message or the help of the given subcommand(s)

Options:
  -h, --help  Print help0
</code></pre>
<p>We can manage a worker, a task, or a group with the <code>manage</code> sub-commands.</p>
<p>For example, we can stop a worker by running:</p>
<pre><code class="language-txt">manage worker b168dbe6-5c44-4529-a3b4-51940d6bb3c5 cancel
</code></pre>
<p>Or we can update the tags of a worker by running:</p>
<pre><code class="language-txt">manage worker b168dbe6-5c44-4529-a3b4-51940d6bb3c5 update-tags wired file
</code></pre>
<p>And we can grant another group <code>Write</code> access to this worker (it means the group can submit tasks to this worker) by running:</p>
<pre><code class="language-txt">manage worker b168dbe6-5c44-4529-a3b4-51940d6bb3c5 update-roles test_group:admin another_group:write
</code></pre>
<p>You can perform the opposite action to remove certain groups' access permissions to the Worker using the <code>remove-roles</code> subcommand.</p>
<p>For a task, we can also cancel it, update its labels or change its specification to run with its UUID provides. For example:</p>
<pre><code class="language-txt">manage task e07a2bf2-166d-40b5-8bb6-a78104c072f9 cancel
</code></pre>
<p>This will cancel the task if it is not started yet.</p>
<p>To change how the task is executed, we can run:</p>
<pre><code class="language-txt">manage task e07a2bf2-166d-40b5-8bb6-a78104c072f9 change --terminal -- echo world
</code></pre>
<p>This will alter the task to collect standard output and error when finishes, and execute <code>echo world</code> instead of <code>echo hello</code>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../guide/worker.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../client/sdk.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../guide/worker.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../client/sdk.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
