<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Mitosis Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="Mitosis is a Rust library and a command line tool to run distributed platforms for transport research.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="guide/installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="guide/coordinator.html"><strong aria-hidden="true">2.</strong> Running a Coordinator</a></li><li class="chapter-item expanded "><a href="guide/worker.html"><strong aria-hidden="true">3.</strong> Running a Worker</a></li><li class="chapter-item expanded "><a href="guide/client.html"><strong aria-hidden="true">4.</strong> Running a Client</a></li><li class="chapter-item expanded affix "><li class="part-title">Reference Guide</li><li class="chapter-item expanded "><a href="client/sdk.html"><strong aria-hidden="true">5.</strong> Client SDK</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Mitosis Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/stack-rs/mitosis/tree/master/guide" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p><strong>Mitosis</strong> is a Rust library and a command line tool to run distributed platforms for transport research.</p>
<p>This guide is an example of how to use Mitosis to run a simple distributed platform to parallelize your tasks.
It is designed for transport-layer research, but it can be used for any other purpose.</p>
<h2 id="basic-workflow"><a class="header" href="#basic-workflow">Basic Workflow</a></h2>
<p>The Mitosis CLI tool is a single binary that provides subcommands for starting the Coordinator, Worker and Client processes.</p>
<p>Users function as units for access control, while groups operate as units for tangible resource control.
Every user has an identically named group but also has the option to create or join additional groups.</p>
<p>Users can delegate tasks to various groups via the Client, which are then delivered to the Coordinator and subsequently executed by the corresponding Worker.
Each Worker can be configured to permit specific groups and carry tags to denote its characteristics.</p>
<p>Tasks, once submitted, are distributed to different Workers based on their groups and tags. Every task is assigned a unique UUID, allowing users to track the status and results of their tasks.</p>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p>Mitosis is free and open source. You can find the source code on
<a href="https://github.com/stack-rs/mitosis">GitHub</a> and issues and feature requests can be posted on
the <a href="https://github.com/stack-rs/mitosis/issues">GitHub issue tracker</a>. Mitosis relies on the community to fix bugs and
add features: if you'd like to contribute, please read
the <a href="https://github.com/stack-rs/mitosis/blob/master/CONTRIBUTING.md">CONTRIBUTING</a> guide and consider opening
a <a href="https://github.com/stack-rs/mitosis/pulls">pull request</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>The Mitosis project contains a CLI tool (named <code>mito</code>) that you can use to directly start a distributed platform,
and a SDK library (named <code>netmito</code>) that you can use to create your own client.
We currently only support Rust for the SDK library. Python SDK is coming soon.</p>
<p>There are multiple ways to install the Mitosis CLI tool.
Choose any one of the methods below that best suit your needs.</p>
<h2 id="pre-compiled-binaries"><a class="header" href="#pre-compiled-binaries">Pre-compiled binaries</a></h2>
<p>Executable binaries are available for download on the <a href="https://github.com/stack-rs/mitosis/releases">GitHub Releases page</a>.
Download the binary and extract the archive.
The archive contains an <code>mito</code> executable which you can run to start your distributed platform.</p>
<p>We have a installer script that you can use to install Mitosis (you may need to adjust the version number in the URL to the latest in the <a href="https://github.com/stack-rs/mitosis/releases">releases</a> page).
You can also change the version number in the URL to install a specific version. This script will install the binary in the <code>$HOME/.cargo/bin</code> directory.</p>
<pre><code class="language-bash">curl --proto '=https' --tlsv1.2 -LsSf https://github.com/stack-rs/mitosis/releases/download/mito-v0.5.2/mito-installer.sh | sh
</code></pre>
<p>You can also download the binary directly from the <a href="https://github.com/stack-rs/mitosis/releases">releases</a> page and install it manually.
To make it easier to run, put the path to the binary into your <code>PATH</code> or install it in a directory that is already in your <code>PATH</code>.
For example, do the following on Linux (you may need to adjust the version number to the latest in the URL):</p>
<pre><code class="language-bash">wget https://github.com/stack-rs/mitosis/releases/download/mito-v0.5.2/mito-x86_64-unknown-linux-gnu.tar.xz
tar xf mito-x86_64-unknown-linux-gnu.tar.xz
cd mito-x86_64-unknown-linux-gnu
sudo install -m 755 mito /usr/local/bin/mito
</code></pre>
<p>If you are using older Linux distributions (with older glibc), you may need to install the musl-compiled releases:</p>
<pre><code class="language-bash">wget https://github.com/stack-rs/mitosis/releases/download/mito-v0.5.2/mito-x86_64-unknown-linux-musl.tar.xz
tar xf mito-x86_64-unknown-linux-musl.tar.xz
cd mito-x86_64-unknown-linux-musl
sudo install -m 755 mito /usr/local/bin/mito
</code></pre>
<h2 id="build-from-source-using-rust"><a class="header" href="#build-from-source-using-rust">Build from source using Rust</a></h2>
<h3 id="dependencies"><a class="header" href="#dependencies">Dependencies</a></h3>
<p>You have to install pkg-config, libssl-dev if you want to build the binary from source.</p>
<h3 id="installing-with-cargo"><a class="header" href="#installing-with-cargo">Installing with Cargo</a></h3>
<p>To build the <code>mito</code> executable from source, you will first need to install Rust and Cargo.
Follow the instructions on the <a href="https://www.rust-lang.org/tools/install">Rust installation page</a>.</p>
<p>Once you have installed Rust, the following command can be used to build and install mito:</p>
<pre><code class="language-bash">cargo install mito
</code></pre>
<p>This will automatically download mito from <a href="https://crates.io/">crates.io</a>, build it, and install it in Cargo's global binary directory (<code>~/.cargo/bin/</code> by default).</p>
<p>You can run <code>cargo install mito</code> again whenever you want to update to a new version.
That command will check if there is a newer version, and re-install mito if a newer version is found.</p>
<p>To uninstall, run the command <code>cargo uninstall mito</code>.</p>
<h3 id="installing-the-latest-git-version-with-cargo"><a class="header" href="#installing-the-latest-git-version-with-cargo">Installing the latest git version with Cargo</a></h3>
<p>The version published to crates.io will ever so slightly be behind the version hosted on GitHub.
If you need the latest version you can build the git version of mito yourself.
Cargo makes this <strong><em>super easy</em></strong>!</p>
<pre><code class="language-bash">cargo install --git https://github.com/stack-rs/mitosis.git mito
</code></pre>
<p>Again, make sure to add the Cargo bin directory to your <code>PATH</code>.</p>
<h3 id="building-from-source"><a class="header" href="#building-from-source">Building from source</a></h3>
<p>If you want to build the binary from source, you can clone the repository and build it using Cargo.</p>
<pre><code class="language-bash">git clone https://github.com/stack-rs/mitosis.git
cd mitosis
cargo build --release
</code></pre>
<p>Then you can find the binary in <code>target/release/mito</code> and install or run it as you like.</p>
<h3 id="common-building-errors"><a class="header" href="#common-building-errors">Common building errors</a></h3>
<p>If you encounter compilation errors on rustls or aws-lc-sys in older Linux distributions, check gcc version and consider updating it.
For example:</p>
<pre><code class="language-bash">sudo apt update -y
sudo apt upgrade -y
sudo apt install -y build-essential
sudo apt install -y gcc-10 g++-10 cpp-10
sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-10 100 --slave /usr/bin/g++ g++ /usr/bin/g++-10 --slave /usr/bin/gcov gcov /usr/bin/gcov-10
</code></pre>
<h2 id="modifying-and-contributing"><a class="header" href="#modifying-and-contributing">Modifying and contributing</a></h2>
<p>If you are interested in making modifications to Mitosis itself, check out the <a href="https://github.com/stack-rs/mitosis/blob/master/CONTRIBUTING.md">Contributing Guide</a> for more information.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="running-a-coordinator"><a class="header" href="#running-a-coordinator">Running a Coordinator</a></h1>
<p>A Coordinator is a process that manages the execution of a workflow.
It is responsible for scheduling tasks, tracking their progress, and handling failures.
The Coordinator is a long-running process that is typically deployed as a service.</p>
<h2 id="external-requirements"><a class="header" href="#external-requirements">External Requirements</a></h2>
<p>The Coordinator requires access to several external services.
It needs a PostgreSQL database to store data, an S3-compatible storage service to store task artifacts or group attachments.
The Redis server is an optional service that acts as a pub/sub provider,
enabling clients to subscribe to and query more comprehensive details regarding the execution status of tasks.</p>
<p>For those services, you can use the docker-compose file provided in the repository.
First, Copy <code>.env.example</code> to <code>.env</code> and set the variables in it.
You have file variables to configure:</p>
<pre><code class="language-txt">DB_USERNAME=
DB_PASSWORD=
S3_USERNAME=
S3_PASSWORD=
KV_PASSWORD=
</code></pre>
<p>And then, run the following command to start the services:</p>
<pre><code class="language-bash">docker-compose up -d
</code></pre>
<p>The Coordinator also requires a private and public key pair to sign and verify access tokens.
For the private and public keys, you can generate them using the following commands:</p>
<pre><code class="language-bash">openssl genpkey -algorithm ed25519 -out private.pem
openssl pkey -in private.pem -pubout -out public.pem
</code></pre>
<h2 id="starting-a-coordinator"><a class="header" href="#starting-a-coordinator">Starting a Coordinator</a></h2>
<p>To start a Coordinator, you need to provide a TOML file that configures the Coordinator.
The TOML file specifies the Coordinator's configuration, such as the address it binds to, the URL of the postgres database, and token expiry settings.
All configuration options are optional and have default values.</p>
<p>The Coordinator will merge the configuration from the file and the command-line arguments according to the following order (the latter overrides the former):</p>
<pre><code class="language-md">DEFAULT &lt;- `$CONFIG_DIR`/mitosis/config.toml &lt;- config file specified by `cli.config` or loal `config.toml` &lt;- env prefixed by `MITO_` &lt;- cli arguments

`$CONFIG_DIR` will be different on different platforms:

- Linux: `$XDG_CONFIG_HOME` or `$HOME`/.config
- macOS: `$HOME`/Library/Application Support
- Windows: {FOLDERID_RoamingAppData}
</code></pre>
<p>Here is an example of a Coordinator configuration file (you can also refer to <code>config.example.toml</code> in the repository):</p>
<pre><code class="language-toml">[coordinator]
bind = "127.0.0.1:5000"
db_url = "postgres://mitosis:mitosis@localhost/mitosis"
s3_url = "http://127.0.0.1:9000"
s3_access_key = "mitosis_access"
s3_secret_key = "mitosis_secret"
# redis_url is not set. It should be in format like "redis://:mitosis@localhost"
# redis_worker_password is not set by default and will be generated randomly
# redis_client_password is not set by default and will be generated randomly
# admin_user specifies the username of the admin user created on startup
admin_user = "mitosis_admin"
# admin_password specifies the password of the admin user created on startup
admin_password = "mitosis_admin"
access_token_private_path = "private.pem"
access_token_public_path = "public.pem"
access_token_expires_in = "7d"
heartbeat_timeout = "600s"
file_log = false
# log_path is not set. It will use the default rolling log file path if file_log is set to true
</code></pre>
<p>To start a Coordinator, run the following command:</p>
<pre><code class="language-bash">mito coordinator --config /path/to/coordinator.toml
</code></pre>
<p>The Coordinator will start and listen for incoming requests on the specified address.</p>
<p>We can also override the configuration settings using command-line arguments.
Note that the names of command-line arguments may not be the same as those in the configuration file.
For example, to change the address the Coordinator binds to, you can run:</p>
<pre><code class="language-bash">mito coordinator --config /path/to/coordinator.toml --bind 0.0.0.0:8000
</code></pre>
<p>The full list of command-line arguments can be found by running <code>mito coordinator --help</code>:</p>
<pre><code class="language-txt">Run the mitosis coordinator

Usage: mito coordinator [OPTIONS]

Options:
  -b, --bind &lt;BIND&gt;
          The address to bind to
      --config &lt;CONFIG&gt;
          The path of the config file
      --db &lt;DB_URL&gt;
          The database URL
      --s3 &lt;S3_URL&gt;
          The S3 URL
      --s3-access-key &lt;S3_ACCESS_KEY&gt;
          The S3 access key
      --s3-secret-key &lt;S3_SECRET_KEY&gt;
          The S3 secret key
      --redis &lt;REDIS_URL&gt;
          The Redis URL
      --redis-worker-password &lt;REDIS_WORKER_PASSWORD&gt;
          The Redis worker password
      --redis-client-password &lt;REDIS_CLIENT_PASSWORD&gt;
          The Redis client password
      --admin-user &lt;ADMIN_USER&gt;
          The admin username
      --admin-password &lt;ADMIN_PASSWORD&gt;
          The admin password
      --access-token-private-path &lt;ACCESS_TOKEN_PRIVATE_PATH&gt;
          The path to the private key, default to `private.pem`
      --access-token-public-path &lt;ACCESS_TOKEN_PUBLIC_PATH&gt;
          The path to the public key, default to `public.pem`
      --access-token-expires-in &lt;ACCESS_TOKEN_EXPIRES_IN&gt;
          The access token expiration time, default to 7 days
      --heartbeat-timeout &lt;HEARTBEAT_TIMEOUT&gt;
          The heartbeat timeout, default to 600 seconds
      --log-path &lt;LOG_PATH&gt;
          The log file path. If not specified, then the default rolling log file path would be used. If specified, then the log file would be exactly at the path specified
      --file-log
          Enable logging to file
  -h, --help
          Print help
  -V, --version
          Print version
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="running-a-worker"><a class="header" href="#running-a-worker">Running a Worker</a></h1>
<p>A Worker is a process that executes tasks.
It is responsible for fetching tasks from the Coordinator, executing them, and reporting the results back to the Coordinator.
The Worker is a long-running process that is typically deployed as a service.</p>
<h2 id="starting-a-worker"><a class="header" href="#starting-a-worker">Starting a Worker</a></h2>
<p>To start a Worker, you need to provide a TOML file that configures the Worker.
The TOML file specifies the Worker's configuration, such as the polling (fetching) interval, the URL of the Coordinator, and the the groups allowed to submit tasks to it.
All configuration options are optional and have default values.</p>
<p>The Worker will merge the configuration from the file and the command-line arguments according to the following order (the latter overrides the former):</p>
<pre><code class="language-md">DEFAULT &lt;- `$CONFIG_DIR`/mitosis/config.toml &lt;- config file specified by `cli.config` or loal `config.toml` &lt;- env prefixed by `MITO_` &lt;- cli arguments

`$CONFIG_DIR` will be different on different platforms:

- Linux: `$XDG_CONFIG_HOME` or `$HOME`/.config
- macOS: `$HOME`/Library/Application Support
- Windows: {FOLDERID_RoamingAppData}
</code></pre>
<p>Here is an example of a Worker configuration file (you can also refer to <code>config.example.toml</code> in the repository):</p>
<pre><code class="language-toml">[worker]
coordinator_addr = "http://127.0.0.1:5000"
polling_interval = "3m"
heartbeat_interval = "5m"
lifetime = "7d"
# credential_path is not set
# user is not set
# password is not set
# groups are not set, default to the user's group
# tags are not set
file_log = false
# log_path is not set. It will use the default rolling log file path if file_log is set to true
# lifetime is not set, default to the coordinator's setting
</code></pre>
<p>To start a Worker, run the following command:</p>
<pre><code class="language-bash">mito worker --config /path/to/worker.toml
</code></pre>
<p>The Worker will start and fetch tasks from the Coordinator at the specified interval.</p>
<p>We can also override the configuration settings using command-line arguments.
Note that the names of command-line arguments may not be the same as those in the configuration file.
For example, to change the polling interval, you can run:</p>
<pre><code class="language-bash">mito worker --config /path/to/worker.toml --polling-interval 5m
</code></pre>
<p>You can also specify the groups and their roles to this Worker using the <code>--groups</code> argument.
The default roles for the groups are <code>Write</code>, meaning that the groups can submit tasks to this Worker.
Groups have <code>Read</code> roles can query the Worker for its status and tasks.
Groups have <code>Admin</code> roles can manage the Worker, such as stopping it or changing its configuration.</p>
<pre><code class="language-bash">mito worker --config /path/to/worker.toml --groups group1,group2:write,group3:read,group4:admin
</code></pre>
<p>This will grant group1 and group2 <code>Write</code> roles, group3 <code>Read</code> role, and group4 <code>Admin</code> role to the Worker.
The user who creates the Worker will be automatically granted the <code>Admin</code> role of the Worker.</p>
<p>Another important argument is <code>--tags</code>, the tags of the Worker.
It defines the characteristics of the Worker, such as its capabilities or the type of tasks it can handle.
It is designed for some specific tasks who has special requirements on Workers.
Only when a Worker's tags are empty or are the subset of the task's tags, the Worker can fetch the task.</p>
<p>The full list of command-line arguments can be found by running <code>mito worker --help</code>:</p>
<pre><code class="language-txt">Run a mitosis worker

Usage: mito worker [OPTIONS]

Options:
      --config &lt;CONFIG&gt;
          The path of the config file
  -c, --coordinator &lt;COORDINATOR_ADDR&gt;
          The address of the coordinator
      --polling-interval &lt;POLLING_INTERVAL&gt;
          The interval to poll tasks or resources
      --heartbeat-interval &lt;HEARTBEAT_INTERVAL&gt;
          The interval to send heartbeat
      --credential-path &lt;CREDENTIAL_PATH&gt;
          The path of the user credential file
  -u, --user &lt;USER&gt;
          The username of the user
  -p, --password &lt;PASSWORD&gt;
          The password of the user
  -g, --groups [&lt;GROUPS&gt;...]
          The groups allowed to submit tasks to this worker
  -t, --tags [&lt;TAGS&gt;...]
          The tags of this worker
      --log-path &lt;LOG_PATH&gt;
          The log file path. If not specified, then the default rolling log file path would be used. If specified, then the log file would be exactly at the path specified
      --file-log
          Enable logging to file
      --lifetime &lt;LIFETIME&gt;
          The lifetime of the worker to alive (e.g., 7d, 1year)
  -h, --help
          Print help
  -V, --version
          Print version
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="running-a-client"><a class="header" href="#running-a-client">Running a Client</a></h1>
<p>A Client is a process that interact with the Coordinator.
It is responsible for creating tasks, querying their results, and managing workers or groups.
The Client is a short-lived process that is typically run on-demand.</p>
<h2 id="starting-a-client"><a class="header" href="#starting-a-client">Starting a Client</a></h2>
<p>While it's possible to provide a TOML configuration file to the client,
it's often unnecessary given the limited number of configuration items, all of which pertain to login procedures.
But it can be useful if you want to set some default values for the client.</p>
<p>The Client will merge the configuration from the file and the command-line arguments according to the following order (the latter overrides the former):</p>
<pre><code class="language-md">DEFAULT &lt;- `$CONFIG_DIR`/mitosis/config.toml &lt;- config file specified by `cli.config` or loal `config.toml` &lt;- env prefixed by `MITO_` &lt;- cli arguments

`$CONFIG_DIR` will be different on different platforms:

- Linux: `$XDG_CONFIG_HOME` or `$HOME`/.config
- macOS: `$HOME`/Library/Application Support
- Windows: {FOLDERID_RoamingAppData}
</code></pre>
<p>Typically, to start a Client, we can simply run the following command to enter interactive mode:</p>
<pre><code class="language-bash">mito client -i
</code></pre>
<p>If a user has never logged in or if his/her session has expired, the Client will prompt them to re-input their username and password for authentication.
Alternatively, they can directly specify their username (<code>-u</code>) or password (<code>-p</code>) during execution.
Once authenticated, the Client will retain their credentials in a file for future use.</p>
<p>We recommend using the interactive mode for most operations, as it provides a more user-friendly experience. It will prompt you something like this:</p>
<pre><code class="language-txt">[mito::client]&gt;
</code></pre>
<p>You can press <code>CTRL-D</code> or type in <code>exit</code> or <code>quit</code> to leave the interactive mode. <code>CTRL-C</code> will just clear the current line and prompt you again.</p>
<p>We can also directly run a command without entering interactive mode by specifying the command as an argument.
For example, to create a new user, we can run:</p>
<pre><code class="language-bash">mito client admin users create new_user_name new_password
</code></pre>
<p>The full list of command-line arguments can be found by running <code>mito client --help</code>:</p>
<pre><code class="language-txt">Run a mitosis client

Usage: mito client [OPTIONS] [COMMAND]

Commands:
  admin    Admin operations, including shutdown the coordinator, chaning user password, etc
  auth     Authenticate current user
  login    Login with username and password
  users    Manage users, including changing password, querying the accessible groups etc
  groups   Manage groups, including creating a group, querying groups, etc
  tasks    Manage tasks, including submitting a task, querying tasks, etc
  workers  Manage workers, including querying workers, cancel workers, etc
  cmd      Run an external command
  quit     Quit the client's interactive mode [aliases: exit]
  help     Print this message or the help of the given subcommand(s)

Options:
      --config &lt;CONFIG&gt;
          The path of the config file
  -c, --coordinator &lt;COORDINATOR_ADDR&gt;
          The address of the coordinator
      --credential-path &lt;CREDENTIAL_PATH&gt;
          The path of the user credential file
  -u, --user &lt;USER&gt;
          The username of the user
  -p, --password &lt;PASSWORD&gt;
          The password of the user
  -i, --interactive
          Enable interactive mode
      --retain
          Whether to retain the previous login state without refetching the credential
  -h, --help
          Print help
  -V, --version
          Print version
</code></pre>
<p>To know how each subcommand works, you can run <code>mito client &lt;subcommand&gt; --help</code>.
For example, to know how to create a new user, you can run <code>mito client admin users create --help</code>:</p>
<pre><code class="language-txt">Create a new user

Usage: mito client admin users create [OPTIONS] [USERNAME] [PASSWORD]

Arguments:
  [USERNAME]  The username of the user
  [PASSWORD]  The password of the user

Options:
      --admin    Whether to grant the new user as an admin user
  -h, --help     Print help
  -V, --version  Print version
</code></pre>
<p>For the rest of this section, we will explain the common use cases of the Client on different scenarios.
For the sake of convenience, we will assume that the user is already in interactive mode.
And for the direct executing mode, it only requires adding "mito client" at the front.</p>
<h2 id="admin-sub-commands"><a class="header" href="#admin-sub-commands"><code>admin</code> sub-commands</a></h2>
<p>Input <code>help admin</code> to show the help message of the <code>admin</code> sub-commands:</p>
<pre><code class="language-txt">Admin operations, including shutdown the coordinator, chaning user password, etc

Usage: admin &lt;COMMAND&gt;

Commands:
  users     Manage users
  shutdown  Shutdown the coordinator
  groups    Manage groups
  tasks     Manage a task
  workers   Manage a worker
  help      Print this message or the help of the given subcommand(s)

Options:
  -h, --help  Print help
</code></pre>
<p>The admin operations are only available to admin users.</p>
<p>For example, we can create a new user by running the following command:</p>
<pre><code class="language-txt">admin users create test_user_name test_user_password
</code></pre>
<p>We can change password of a user by running:</p>
<pre><code class="language-txt">admin users change-password test_user_name new_test_user_password
</code></pre>
<h2 id="groups-sub-commands"><a class="header" href="#groups-sub-commands"><code>groups</code> sub-commands</a></h2>
<p>Input <code>help groups</code> to show the help message of the <code>groups</code> sub-commands:</p>
<pre><code class="language-txt">Manage groups, including creating a group, querying groups, etc

Usage: groups &lt;COMMAND&gt;

Commands:
  create       Create a new group
  get          Get the information of a group
  update-user  Update the roles of users to a group
  remove-user  Remove the accessibility of users from a group
  attachments  Query, upload, download or delete an attachment
  help         Print this message or the help of the given subcommand(s)

Options:
  -h, --help  Print help
</code></pre>
<p>We can manage group related operations with the <code>groups</code> sub-commands, such as creating a new group, querying a group, managing users' access to a group, and managing attachments of a group.</p>
<p>We can create a new group by running the following command:</p>
<pre><code class="language-txt">groups create test_group
</code></pre>
<p>This will create a group called <code>test_group</code> containing the current logged in user.
This user will be granted the <code>Admin</code> role to this group to manage it.</p>
<p>We can get the information of a group by running:</p>
<pre><code class="language-txt">groups get test_group
</code></pre>
<h3 id="attachments-sub-commands"><a class="header" href="#attachments-sub-commands"><code>attachments</code> sub-commands</a></h3>
<p>Input <code>help groups attachments</code> or <code>groups attachments -h</code> to show the help message of the <code>attachments</code> sub-commands:</p>
<pre><code class="language-txt">Query, upload, download or delete an attachment

Usage: groups attachments &lt;COMMAND&gt;

Commands:
  delete    Delete an attachment from a group
  upload    Upload an attachment to a group
  get       Get the metadata of an attachment
  download  Download an attachment of a group
  query     Query attachments subject to the filter
  help      Print this message or the help of the given subcommand(s)

Options:
  -h, --help  Print help
</code></pre>
<p>This is used to upload, download, delete or query attachments of a group.</p>
<p>For example, to upload an attachment to a group, we can run:</p>
<pre><code class="language-txt">groups attachments upload -g test_group local.tar.gz attachment_key
</code></pre>
<p>You can also just run <code>groups attachments upload local.tar.gz</code>.
This will directly upload the file to the current group you are in and use the file name as the attachment key.</p>
<p>Also, you can specify the attachment key to be a directory-like string, ending with a <code>/</code>. This will smartly upload local file to <code>attachment_key/local_file_name</code>.</p>
<p>For example, to upload a file <code>local.tar.gz</code> to a directory <code>dir/</code> in the group, you can run:</p>
<pre><code class="language-txt">groups attachments upload -g test_group local.tar.gz dir/
</code></pre>
<p>This will save the attachment with key <code>dir/local.tar.gz</code>.</p>
<p>To download an attachment of a group, you can just:</p>
<pre><code class="language-txt">groups attachments download -g test_group dir/local.tar.gz
</code></pre>
<p>We also offer a smart mode to make downloading easier.</p>
<p>You can specify the group_name in the first segment of the attachment key, separated by a <code>/</code>, if no group_name specified by <code>-g</code>, and we will use the last segment of the attachment key as the local file name if no output path specified by <code>-o</code>. For example:</p>
<pre><code class="language-txt">groups attachments download test_group/dir/local.tar.gz
</code></pre>
<p>This will download the attachment <code>dir/local.tar.gz</code> from group <code>test_group</code> and save it as <code>local.tar.gz</code> in the current directory.</p>
<h2 id="tasks-sub-commands"><a class="header" href="#tasks-sub-commands"><code>tasks</code> sub-commands</a></h2>
<p>Input <code>help tasks</code> to show the help message of the <code>tasks</code> sub-commands:</p>
<pre><code class="language-txt">Manage tasks, including submitting a task, querying tasks, etc

Usage: tasks &lt;COMMAND&gt;

Commands:
  submit         Submit a task
  get            Get the info of a task
  query          Query tasks subject to the filter
  cancel         Cancel a task
  update-labels  Replace labels of a task
  change         Update the spec of a task
  artifacts      Query, upload, download or delete an artifact
  help           Print this message or the help of the given subcommand(s)

Options:
  -h, --help  Print help
</code></pre>
<p>Submit a task to the Coordinator can be as simple as running the following command:</p>
<pre><code class="language-txt">tasks submit -- echo hello
</code></pre>
<p>The content after <code>--</code> is the command to run on the worker. It will return a UUID to identify the task.</p>
<p>You can also specify the group to submit the task to by using the <code>-g</code> option.</p>
<p>The <code>--labels</code> are used to mark the task for querying later, it won't affect how the task is fetched ans executed.</p>
<p>The <code>--tags</code> are used to define the characteristics of the task, such as its requirements on the Worker.
Only when a Worker's tags are empty or are the subset of the task's tags, the Worker can fetch the task.</p>
<p>You can also set some environment variables for the task by using the <code>-e</code> option.</p>
<pre><code class="language-txt">tasks submit -g test_group -t wireless,4g -l mobile,video -e TEST_KEY=1,TEST_VAL=2 -- echo hello
</code></pre>
<p>For the output of the task, we allow 3 types of output to be collected:</p>
<ol>
<li><strong>Result</strong>: Files put under the directory specified by the environment variable <code>MITO_RESULT_DIR</code> will be packed into an artifact and uploaded to the Coordinator.
If the directory is empty, no artifact will be created.</li>
<li><strong>Exec</strong>: Files put under the directory specified by the environment variable <code>MITO_EXEC_DIR</code> will be packed into an artifact and uploaded to the Coordinator.
If the directory is empty, no artifact will be created.</li>
<li><strong>Terminal</strong>: If the <code>--terminal</code> option is specified, the standard output and error of the executed task will be collected and uploaded to the Coordinator.
The terminal output will be stored in a file named <code>stdout.log</code> and <code>stderr.log</code> respectively in an artifact.</li>
</ol>
<p>Now, we get a submitted task's information by providing its UUID:</p>
<pre><code class="language-txt">tasks get e07a2bf2-166d-40b5-8bb6-a78104c072f9
</code></pre>
<p>Or we can just query a list of tasks with label <code>mobile</code>:</p>
<pre><code class="language-txt">tasks query -l mobile
</code></pre>
<p>More filter options can be found in the help message by executing <code>tasks query -h</code></p>
<p>For a task, we can also cancel it, update its labels or change its specification to run with its UUID provides. For example:</p>
<pre><code class="language-txt">tasks cancel e07a2bf2-166d-40b5-8bb6-a78104c072f9
</code></pre>
<p>This will cancel the task if it is not started yet. It is not allowed to cancel a running or finished task.</p>
<p>To change how the task is executed (i.e., the spec of this task), we can run:</p>
<pre><code class="language-txt">tasks change e07a2bf2-166d-40b5-8bb6-a78104c072f9 --terminal -- echo world
</code></pre>
<p>This will alter the task to collect standard output and error when finishes, and execute <code>echo world</code> instead of <code>echo hello</code>.</p>
<p>We can download the results (a collection of files generated by a task as output) collected by the task as an artifact.</p>
<p>It is easy to download an artifact of a task by providing its UUID. But you also have to specify the output type you want.
There are three types of output: <code>result</code>, <code>exec-log</code>, and <code>std-log</code>. You can also specify the output path to download the artifact to with <code>-o</code> argument.</p>
<pre><code class="language-txt">tasks artifacts download e07a2bf2-166d-40b5-8bb6-a78104c072f9 result
</code></pre>
<h2 id="workers-sub-commands"><a class="header" href="#workers-sub-commands"><code>workers</code> sub-commands</a></h2>
<p>Input <code>help workers</code> to show the help message of the <code>workers</code> sub-commands:</p>
<pre><code class="language-txt">Manage workers, including querying workers, cancel workers, etc

Usage: workers &lt;COMMAND&gt;

Commands:
  cancel        Cancel a worker
  update-tags   Replace tags of a worker
  update-roles  Update the roles of groups to a worker
  remove-roles  Remove the accessibility of groups from a worker
  get           Get information about a worker
  query         Query workers subject to the filter
  help          Print this message or the help of the given subcommand(s)

Options:
  -h, --help  Print help
</code></pre>
<p>We can manage a worker, and get relevant information about it with the <code>workers</code> sub-commands.</p>
<p>For example, we can stop a worker by running:</p>
<pre><code class="language-txt">workers cancel b168dbe6-5c44-4529-a3b4-51940d6bb3c5
</code></pre>
<p>Or we can update the tags of a worker by running:</p>
<pre><code class="language-txt">workers update-tags b168dbe6-5c44-4529-a3b4-51940d6bb3c5 wired file
</code></pre>
<p>And we can grant another group <code>Write</code> access to this worker (it means the group can submit tasks to this worker) by running:</p>
<pre><code class="language-txt">workers update-roles b168dbe6-5c44-4529-a3b4-51940d6bb3c5 test_group:admin another_group:write
</code></pre>
<p>You can perform the opposite action to remove certain groups' access permissions to the Worker using the <code>remove-roles</code> subcommand.</p>
<h2 id="cmd-sub-commands"><a class="header" href="#cmd-sub-commands"><code>cmd</code> sub-commands</a></h2>
<p>Input <code>help cmd</code> to show the help message of the <code>cmd</code> sub-commands:</p>
<pre><code class="language-txt">Run an external command

Usage: cmd [OPTIONS] [-- &lt;COMMAND&gt;...]

Arguments:
  [COMMAND]...  The command to run

Options:
  -s, --split  Do not merge the command into one string
  -h, --help   Print help
</code></pre>
<p>We can use this sub-command to run an external command. For example, to list files in the current directory, we can run:</p>
<pre><code>cmd -- ls -hal
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="client-sdk"><a class="header" href="#client-sdk">Client SDK</a></h1>
<p>The Mitosis project contains a SDK library (named <code>netmito</code>) that you can use to create your own client programmatically.</p>
<p>To use the SDK, add the following to your <code>Cargo.toml</code>:</p>
<pre><code class="language-toml">[dependencies]
netmito = "0.5"
</code></pre>
<p>Here is a simple example of how to create a new user using the SDK:</p>
<pre><code class="language-rust ignore"><span class="boring">use netmito::client::MitoClient;
</span><span class="boring">use netmito::config::client::{ClientConfig, AdminCreateUserArgs};
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>// Create a new client configuration
let config = ClientConfig::default();
// Setup the client
let mut client = MitoClient::new(config);
// Fill up arguments for creating a new user
let args = AdminCreateUserArgs {
    username: Some("new_user".to_string()),
    password: Some("new_password".to_string()),
    admin: false,
};
// Create a new user
client.admin_create_user(args).await.unwrap();
<span class="boring">}</span></code></pre>
<p>For more details, please refer to the <a href="https://docs.rs/netmito">API documentation</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
